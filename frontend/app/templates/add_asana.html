<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <title>Add Asana</title>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <a href="/" class="navbar-brand">Asana –ö–∞—Ç–∞–ª–æ–≥</a>
            <div class="navbar-links">
                <a href="/">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="form-container animate-fade-in">
            <h1 class="text-center">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∞—Å–∞–Ω—ã</h1>
            
            <form method="post" enctype="multipart/form-data">
                <!-- Name section -->
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∞—Å–∞–Ω—ã:</label>
                    <select name="selected_name" id="existing_name" class="form-control" onchange="toggleNameFields(this.value)" required>
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ --</option>
                        {% for name in names %}
                            <option value="{{ name.id }}" 
                                    data-ru="{{ name.name_ru }}" 
                                    data-en="{{ name.name_en }}" 
                                    data-sanskrit="{{ name.name_sanskrit }}">
                                {{ name.name_ru }} / {{ name.name_en }} / {{ name.name_sanskrit }}
                            </option>
                        {% endfor %}
                        <option value="new">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</option>
                    </select>

                    <div id="new_name_fields" class="mt-4" style="display:none;">
                        <div class="form-group">
                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º:</label>
                            <input type="text" name="new_name_ru" class="form-control new-name-field" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–∑–∞ –ª–æ—Ç–æ—Å–∞">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º:</label>
                            <input type="text" name="new_name_en" class="form-control new-name-field" placeholder="Example: Lotus Pose">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Å–∞–Ω—Å–∫—Ä–∏—Ç–µ:</label>
                            <input type="text" name="new_name_sanskrit" class="form-control new-name-field" placeholder="Example: Padmasana">
                        </div>
                    </div>
                </div>

                <!-- Source section -->
                <div class="form-group">
                    <label class="form-label">–ò—Å—Ç–æ—á–Ω–∏–∫:</label>
                    <select name="selected_source" id="existing_source" class="form-control" onchange="toggleSourceFields(this.value)" required>
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ --</option>
                        {% for source in sources %}
                            <option value="{{ source.id }}"
                                    data-title="{{ source.title }}"
                                    data-author="{{ source.author }}"
                                    data-year="{{ source.year }}">
                                {{ source.title }} ({{ source.author }}, {{ source.year }})
                            </option>
                        {% endfor %}
                        <option value="new">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫</option>
                    </select>

                    <div id="new_source_fields" class="mt-4" style="display:none;">
                        <div class="form-group">
                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞:</label>
                            <input type="text" name="new_source_title" class="form-control new-source-field" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏/–∏—Å—Ç–æ—á–Ω–∏–∫–∞">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ê–≤—Ç–æ—Ä:</label>
                            <input type="text" name="new_source_author" class="form-control new-source-field" placeholder="–ò–º—è –∞–≤—Ç–æ—Ä–∞">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ì–æ–¥:</label>
                            <input type="number" name="new_source_year" class="form-control new-source-field" placeholder="–ì–æ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏">
                        </div>
                    </div>
                </div>

                <!-- Photo upload -->
                <div class="form-group">
                    <label class="form-label">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –∞—Å–∞–Ω—ã:</label>
                    <div class="photo-upload-container" id="photoUploadContainer">
                        <div class="photo-upload-icon">üì∏</div>
                        <label class="photo-upload-label">
                            <span id="uploadText">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ —Å—é–¥–∞</span>
                            <input type="file" name="photo" accept="image/*" required id="photoInput">
                        </label>
                        <img id="photoPreview" class="photo-preview" alt="Preview">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">–î–æ–±–∞–≤–∏—Ç—å –∞—Å–∞–Ω—É</button>
            </form>
        </div>
    </div>

    <script>
    function toggleNameFields(value) {
        const newFields = document.getElementById('new_name_fields');
        const newNameInputs = document.querySelectorAll('.new-name-field');
        
        if (value === 'new') {
            newFields.style.display = 'block';
            newNameInputs.forEach(input => {
                input.required = true;
            });
        } else {
            newFields.style.display = 'none';
            newNameInputs.forEach(input => {
                input.required = false;
                input.value = '';
            });
        }
    }

    function toggleSourceFields(value) {
        const newFields = document.getElementById('new_source_fields');
        const newSourceInputs = document.querySelectorAll('.new-source-field');
        
        if (value === 'new') {
            newFields.style.display = 'block';
            newSourceInputs.forEach(input => {
                input.required = true;
            });
        } else {
            newFields.style.display = 'none';
            newSourceInputs.forEach(input => {
                input.required = false;
                input.value = '';
            });
        }
    }

    // Photo upload preview
    const photoInput = document.getElementById('photoInput');
    const photoPreview = document.getElementById('photoPreview');
    const uploadText = document.getElementById('uploadText');
    const photoContainer = document.getElementById('photoUploadContainer');

    photoInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                photoPreview.src = e.target.result;
                photoPreview.style.display = 'block';
                uploadText.textContent = '–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ';
            }
            reader.readAsDataURL(file);
        }
    });

    // Drag and drop handling
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        photoContainer.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        photoContainer.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        photoContainer.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
        photoContainer.classList.add('dragover');
    }

    function unhighlight(e) {
        photoContainer.classList.remove('dragover');
    }

    photoContainer.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const file = dt.files[0];
        if (file && file.type.startsWith('image/')) {
            photoInput.files = dt.files;
            const event = new Event('change');
            photoInput.dispatchEvent(event);
        }
    }
    </script>
</body>
</html>